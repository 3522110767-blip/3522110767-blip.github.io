<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4f46e5"/>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icon-192x192.png">
    
    <title>ByteCraft - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="dashboard.css">
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

    <div id="offline-alert" class="hidden bg-red-600 text-white text-center py-2 px-4 fixed top-0 w-full z-50 shadow-lg transition-transform transform -translate-y-full">
        <i class="fas fa-wifi-slash mr-2"></i> No hay conexión a internet. Modo solo lectura activado.
    </div>

    <header class="bg-white shadow-sm p-4 sticky top-0 z-20 flex justify-between items-center md:hidden">
        <span data-page="dashboard" class="text-2xl font-bold text-gradient cursor-pointer">ByteCraft</span>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-20"> 

        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            
            <div class="flex items-center mb-4 md:mb-0">
                <button id="back-button" onclick="handleGoBack()" class="p-2 mr-3 text-gray-500 hover:text-indigo-600 transition bg-white rounded-full shadow md:hidden" style="display:none;">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 id="page-title" class="text-3xl font-extrabold text-gray-900">
                    <span class="text-gradient">Dashboard</span>
                </h1>
            </div>

            <div class="flex space-x-3">
                <button id="install-button" class="px-4 py-2 bg-indigo-600 text-white rounded-full text-sm font-medium hover:bg-indigo-700 transition hidden">
                    <i class="fas fa-download mr-2"></i> Instalar App
                </button>
                
                <div class="relative">
                    <button id="notification-button" class="p-2 text-gray-500 hover:text-indigo-600 transition bg-white rounded-full shadow">
                        <i class="fas fa-bell"></i>
                        <span id="notification-badge" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full hidden">3</span>
                    </button>
                    <div id="notification-dropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl z-10 hidden overflow-hidden">
                        <div id="notification-list" class="divide-y divide-gray-100">
                            </div>
                    </div>
                </div>
                
                <button onclick="downloadDBData()" class="p-2 text-gray-500 hover:text-teal-600 transition bg-white rounded-full shadow" title="Descargar Copia de Seguridad">
                    <i class="fas fa-file-export"></i>
                </button>
                
                <button onclick="logout()" class="p-2 text-gray-500 hover:text-indigo-600 transition bg-white rounded-full shadow">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <main id="app-content"></main>
        
        <br class="md:hidden">

        <div id="desktop-nav-cards" class="hidden md:block">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Navegación Rápida</h2>
            <div class="grid grid-cols-2 lg:grid-cols-5 gap-6">
                <div data-page="dashboard" class="dashboard-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition flex flex-col items-center text-center cursor-pointer">
                    <i class="fas fa-tachometer-alt text-4xl text-indigo-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Inicio</h3>
                </div>
                <div data-page="clientes" class="dashboard-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition flex flex-col items-center text-center cursor-pointer">
                    <i class="fas fa-users text-4xl text-teal-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Clientes</h3>
                </div>
                <div data-page="proyectos" class="dashboard-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition flex flex-col items-center text-center cursor-pointer">
                    <i class="fas fa-project-diagram text-4xl text-purple-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Proyectos</h3>
                </div>
                <div data-page="tareas" class="dashboard-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition flex flex-col items-center text-center cursor-pointer">
                    <i class="fas fa-tasks text-4xl text-yellow-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Tareas</h3>
                </div>
                <div data-page="colaboradores" class="dashboard-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition flex flex-col items-center text-center cursor-pointer">
                    <i class="fas fa-handshake text-4xl text-blue-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Equipo</h3>
                </div>
                <div data-page="configuracion" class="dashboard-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition flex flex-col items-center text-center cursor-pointer">
                    <i class="fas fa-cogs text-4xl text-gray-500 mb-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Configuración</h3>
                </div>
            </div>
            <hr class="my-8 border-gray-200">
        </div>

        <template id="template-dashboard">
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-tachometer-alt text-indigo-500 mr-2"></i> Vista General
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="dashboard-stats"></div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg lg:col-span-2">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i> Alta Prioridad
                        </h3>
                        <ul id="priority-tasks" class="space-y-3"></ul>
                        <p id="no-priority-tasks" class="text-center text-gray-500 mt-4 hidden">Nada pendiente.</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-users text-teal-500 mr-2"></i> Recientes
                        </h3>
                        <ul id="recent-clients" class="space-y-3"></ul>
                    </div>
                </div>
            </div>
        </template>

        <template id="template-clientes">
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-users text-teal-500 mr-2"></i> Clientes
                </h2>
                <div class="flex justify-end">
                    <button onclick="openModal('modal-client')" class="px-4 py-2 bg-teal-600 text-white rounded-full font-medium hover:bg-teal-700 transition action-btn">
                        <i class="fas fa-user-plus mr-2"></i> Añadir
                    </button>
                </div>
                <div id="clients-list" class="space-y-4"></div>
                <p id="no-clients" class="text-center text-gray-500 hidden">No hay clientes.</p>
            </div>
        </template>

        <template id="template-tareas">
            <div class="space-y-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-tasks text-yellow-500 mr-2"></i> Tareas
                    </h2>
                    <div class="flex space-x-3 w-full md:w-auto">
                        <select id="task-filter-status" class="bg-white border border-gray-300 py-2 px-4 rounded-full">
                            <option value="Todas">Todas</option>
                            <option value="Pendiente">Pendientes</option>
                            <option value="En Curso">En Curso</option>
                            <option value="Completada">Completadas</option>
                        </select>
                        <button onclick="openAddTaskModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-full font-medium hover:bg-indigo-700 transition flex items-center justify-center action-btn">
                            <i class="fas fa-plus mr-2"></i> Nueva
                        </button>
                    </div>
                </div>
                <div id="tasks-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <p id="no-tasks" class="text-center text-gray-500 mt-8 hidden">No hay tareas.</p>
            </div>
        </template>

        <template id="template-colaboradores">
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-handshake text-blue-500 mr-2"></i> Equipo
                </h2>
                <div class="flex justify-end">
                    <button onclick="openModal('modal-collaborator')" class="px-4 py-2 bg-blue-600 text-white rounded-full font-medium hover:bg-blue-700 transition action-btn">
                        <i class="fas fa-user-plus mr-2"></i> Nuevo
                    </button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rol</th>
                                <th class="relative px-6 py-3"></th>
                            </tr>
                        </thead>
                        <tbody id="collaborators-list" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                    <p id="no-collaborators" class="text-center text-gray-500 mt-4 hidden">Vacío.</p>
                </div>
            </div>
        </template>

        <template id="template-proyectos">
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-project-diagram text-purple-500 mr-2"></i> Proyectos
                </h2>
                <div class="flex justify-end">
                    <button onclick="openModal('modal-project')" class="px-4 py-2 bg-purple-600 text-white rounded-full font-medium hover:bg-purple-700 transition action-btn">
                        <i class="fas fa-folder-plus mr-2"></i> Nuevo
                    </button>
                </div>
                <div id="projects-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                <p id="no-projects" class="text-center text-gray-500 hidden">No hay proyectos.</p>
            </div>
        </template>

        <template id="template-configuracion">
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-cogs text-gray-500 mr-2"></i> Configuración
                </h2>

                <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Notificaciones Push</h3>
                    <p class="text-sm text-gray-500 mb-4">Activa las notificaciones para recibir alertas incluso cerrada la app.</p>
                    <button onclick="subscribeToPush()" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition w-full md:w-auto flex items-center justify-center">
                        <i class="fas fa-bell mr-2"></i> Activar Notificaciones Push
                    </button>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Papelera de Reciclaje</h3>
                    <ul id="deleted-items-list" class="divide-y divide-gray-200 border border-gray-200 rounded-lg"></ul>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Datos</h3>
                    <button onclick="localStorage.removeItem('bytecraft_db'); location.reload();" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition w-full md:w-auto">
                        <i class="fas fa-trash-alt mr-2"></i> Borrar Todo (Reset)
                    </button>
                </div>
            </div>
        </template>

    </div>

    <div class="fixed bottom-0 left-0 w-full bg-white shadow-lg border-t border-gray-200 md:hidden z-10 pb-safe">
        <div class="flex justify-around items-center h-16">
            <a href="#dashboard" data-page="dashboard" class="nav-link flex flex-col items-center justify-center w-1/6 active"><i class="fas fa-tachometer-alt text-lg"></i></a>
            <a href="#clientes" data-page="clientes" class="nav-link flex flex-col items-center justify-center w-1/6"><i class="fas fa-users text-lg"></i></a>
            <a href="#proyectos" data-page="proyectos" class="nav-link flex flex-col items-center justify-center w-1/6"><i class="fas fa-project-diagram text-lg"></i></a>
            <a href="#tareas" data-page="tareas" class="nav-link flex flex-col items-center justify-center w-1/6"><i class="fas fa-tasks text-lg"></i></a>
            <a href="#colaboradores" data-page="colaboradores" class="nav-link flex flex-col items-center justify-center w-1/6"><i class="fas fa-handshake text-lg"></i></a>
            <a href="#configuracion" data-page="configuracion" class="nav-link flex flex-col items-center justify-center w-1/6"><i class="fas fa-cogs text-lg"></i></a>
        </div>
    </div>

    <div id="modal-client" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-96"><h3 class="font-bold mb-4">Nuevo Cliente</h3><form id="addClientForm"><input id="client-name" class="w-full border p-2 mb-2" placeholder="Nombre" required><input id="client-contact" class="w-full border p-2 mb-4" placeholder="Contacto" required><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-teal-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>
    
    <div id="modal-edit-client" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-96"><h3 class="font-bold mb-4">Editar Cliente</h3><form id="editClientForm"><input type="hidden" id="edit-client-id"><input id="edit-client-name" class="w-full border p-2 mb-2" required><input id="edit-client-contact" class="w-full border p-2 mb-4" required><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>

    <div id="modal-project" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-full max-w-lg"><h3 class="font-bold mb-4">Nuevo Proyecto</h3><form id="addProjectForm"><input id="project-name" class="w-full border p-2 mb-2" placeholder="Nombre Proyecto" required><select id="project-client" class="w-full border p-2 mb-2"></select><input type="date" id="project-duedate" class="w-full border p-2 mb-2" required><select id="project-status" class="w-full border p-2 mb-4"><option>Pendiente</option><option>En Curso</option><option>Completado</option></select><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>

    <div id="modal-edit-project" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-full max-w-lg"><h3 class="font-bold mb-4">Editar Proyecto</h3><form id="editProjectForm"><input type="hidden" id="edit-project-id"><input id="edit-project-name" class="w-full border p-2 mb-2" required><select id="edit-project-client" class="w-full border p-2 mb-2"></select><input type="date" id="edit-project-duedate" class="w-full border p-2 mb-2" required><select id="edit-project-status" class="w-full border p-2 mb-4"><option>Pendiente</option><option>En Curso</option><option>Completado</option></select><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>

    <div id="modal-collaborator" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-96"><h3 class="font-bold mb-4">Nuevo Colaborador</h3><form id="addCollaboratorForm"><input id="collab-name" class="w-full border p-2 mb-2" placeholder="Nombre" required><input id="collab-email" type="email" class="w-full border p-2 mb-2" placeholder="Email" required><select id="collab-role" class="w-full border p-2 mb-4"></select><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>

    <div id="modal-edit-collaborator" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-96"><h3 class="font-bold mb-4">Editar Colaborador</h3><form id="editCollaboratorForm"><input type="hidden" id="edit-collab-id"><input id="edit-collab-name" class="w-full border p-2 mb-2" required><input id="edit-collab-email" class="w-full border p-2 mb-2" required><select id="edit-collab-role" class="w-full border p-2 mb-4"></select><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>

    <div id="modal-add-task" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-full max-w-lg"><h3 class="font-bold mb-4">Nueva Tarea</h3><form id="addTaskForm"><input id="task-title-add" class="w-full border p-2 mb-2" placeholder="Título" required><textarea id="task-description-add" class="w-full border p-2 mb-2" placeholder="Descripción"></textarea><div class="grid grid-cols-2 gap-2"><input type="date" id="task-duedate-add" class="border p-2" required><select id="task-priority-add" class="border p-2"><option>Baja</option><option selected>Media</option><option>Alta</option><option>Urgente</option></select></div><div class="grid grid-cols-2 gap-2 mt-2"><select id="task-assignee-add" class="border p-2"></select><select id="task-client-add" class="border p-2"></select></div><select id="task-status-add" class="w-full border p-2 mt-2 mb-4"><option selected>Pendiente</option><option>En Curso</option><option>Completada</option></select><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>

    <div id="modal-edit-task" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 flex items-center justify-center"><div class="bg-white p-5 rounded-lg shadow-lg w-full max-w-lg"><h3 class="font-bold mb-4">Editar Tarea</h3><form id="editTaskForm"><input type="hidden" id="edit-task-id"><input id="edit-task-title" class="w-full border p-2 mb-2" required><textarea id="edit-task-description" class="w-full border p-2 mb-2"></textarea><div class="grid grid-cols-2 gap-2"><input type="date" id="edit-task-duedate" class="border p-2" required><select id="edit-task-priority" class="border p-2"><option>Baja</option><option>Media</option><option>Alta</option><option>Urgente</option></select></div><div class="grid grid-cols-2 gap-2 mt-2"><select id="edit-task-assignee" class="border p-2"></select><select id="edit-task-client" class="border p-2"></select></div><select id="edit-task-status" class="w-full border p-2 mt-2 mb-4"><option>Pendiente</option><option>En Curso</option><option>Completada</option></select><div class="flex justify-end gap-2"><button type="button" onclick="closeModals()" class="text-gray-500">Cancelar</button><button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded">Guardar</button></div></form></div></div>

    <script src="dashboard.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('SW registrado', reg.scope))
                    .catch(err => console.error('SW error', err));
            });
        }
    </script>
</body>
</html>